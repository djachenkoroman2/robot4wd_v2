#include "Arduino.h" 
#include <Wire.h> //библиотека для работы по протоколу I2C  
#include <MechaQMC5883.h> //библиотека QMC5883 для работы с датчиком QMC583, но не с HMC5883
MechaQMC5883 qmc; //создаем объект для работы с датчиком (магнитометром), даем ему имя qmc
  
void setup() {
  Wire.begin(); //старт связи по протоколу I2C 
  Serial.begin(9600); //старт последовательной связи со скоростью 9600 
  qmc.init(); //инициализация датчика QMC5883 
}
void loop() { //бесконечный цикл
  int x,y,z;
  qmc.read(&x,&y,&z); //считываем значения X, Y и Z с датчика 
  
  int heading=atan2(x, y)/0.0174532925; // рассчитываем направление в градусах используя значения X и Y  
 //преобразуем результат в диапазон от 0 до 360
  if(heading < 0) 
  heading+=360;
  heading = 360-heading;
  
  Serial.println(heading); //передаем значение направления в последовательный порт связи для целей отладки 
//в зависимости от значения рассчитанного направления печатаем результат (для отладки) и зажигаем соответствующий светодиод
  delay(500); // обновление данных каждые полсекунды 
  
}